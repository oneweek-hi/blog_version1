


---
layout: post
title:  "2.2 웹과 HTTP"
date:   2020-10-14T14:25:52-05:00
author: oneweek-hi
categories: Network
tags:   Network, HTTP, 비지속 연결과 지속 연결, 쿠키, 웹캐싱
cover:  "/assets/instacode.png"
---

## 2.2.1 HTTP 개요 

웹의 애플리케이션 계층 프로토콜인 HTTP(HyperText Transfer Protocol)는 웹의 중심이다.

 

*간략한 웹 전문 용어

- 웹페이지(web page): 객체로 구성된다.

- 객체(object): 단순히 단일 URL로 지정할 수 있는 하나의 파일(ex. HTML 파일, JEPG이미지, GIF이미지, 자바 애플릿, 오디오 클립 등)

  대부분의 웹 페이지는 기본 HTML 파일 + 여러 참조 객체

- 웹 서버(Web server): URL로 각각 지정할 수 있는 웹 객체를 갖고 있다. (ex. 아파치, IIS 등)



#### HTTP

HTTP는 웹 클라이언트가 웹 서버에게 웹페이지를 어떻게 요청하는지와 서버가 클라이언트로 어떻게 웹페이지를 전송하는 지를 정의한다.

사용자가 웹 페이지를 요청할 때(ex. 하이퍼링크를 클릭할 때), 브라우저는 페이지 내부의 객체에 대한 HTTP 요청 메세지를 서버에게 보낸다. 서버는 요청을 수신하고 객체를 포함하는 HTTP 응답 메세지로 응답한다.

HTTP는 TCP를 전송 프로토콜로 사용한다. HTTP 클라이언트는 먼저 서버에 TCP 연결을 시작한다. 일단 연결이 이루어지면, 브라우저와 서버 프로세스는 그들의 소켓 인터페이스를 통해 TCP로 접속한다. 

클라이언트는 HTTP요청 메세지를 소켓 인터페이스로 보내고 소켓 인터페이스로 부터 HTTP 응답 메시지를 받는다. TCP는 HTTP에게 신뢰적인 데이터 전송 서비스를 제공한다. <u>즉,  HTTP는 데이터의 손실 이나 TCP가 어떻게 손실 데이터를 복구 하고 네트워크 네부에서 데이터를 올바른 순서로 배열하는지 걱정할 필요가 없다.</u> => 바로 이것이 계층구조의 중요한 장점 중 하나이다!

또한 서버가 클라이언트에게 요청 파일을 보낼 대, 서버는 클라이언트에게 관한 어떠한 상태 정보도 저장하지 않는다.

클라이언트에 대한 정보를 유지 하지 않음으로, **HTTP를 비상태 프로토콜(stateless protocol)**이라고 한다.

또한 웹은 클라이언트-서버 어플리케이션 구조를 사용한다. 웹서버는 항상 켜져있고, 고정 IP주소를 가지며 다른 잠재적인 수백만 브라우저의 요청을 서비스한다.



## 2.2.2 비지속 연결과 지속 연결

#### 비지속 연결 HTTP

- 서버가 각 객체른 보낸 후에 각 TCP 연결이 끊어지므로 비지속 연결을 사용한다.(즉, 연결이 다른 객체를 위해 유지 되지 않음)

- 각 TCP 연결은 하나의 메세지와 하나의 응답 메세지만 전송

- 동시에 TCP를 연결하는지, 순차적으로 연결하는지는 브라우저를 어떻게 구성하냐에 따라 달려있다.

  

  RTT(round-trip-time): 클라이언트 에서 HTML 파일을 요청하고 그 파일이 클라이언트로 수신 될 때까지 걸리는 시간

  (RTT는 패킷 전파 지연, 중간 라우터와 스위치에서 패킷 큐잉 지연, 처리지연등을 포함한다)

  1. 처음에는 핸드 쉐이킹(세방향이지만 두개라고 생각하자.)
  2. 세바향 마지막(응답)을 보낸다.
  3. 그 요청 메세지가 서버에 도착하면 서버는 html파일을 TCP 연결로 보낸다. ->이게 도 하나의 RTT이다.

  = 총 응답시간 2RTT + HTML파일 서버가 전송하는데 걸리는 시간

단점 

1. 각 요청에 객채에 대한 새로운 연결이 설정되고 유지되어야 한다.
2. TCP버퍼가 할당되어야 하고, TCP변수들이 클라이언트와 서버 양쪽에 유지되어야 한다. -> 수많은 다른 클라이언트의 요청을 동시에 서비스하는 웹서버에게 심각한 부담을 줄 수가 있다.

#### 지속 연결 HTTP

- 서버는 응답을 보낸 후에 TCP연결을 그대로 유지한다. = 같은 클라이언트와 서버 간의 이후 요청과 응답은 같은 연결을 통해 보내진다.
- 객체에 대한 요구는 진행 중인 요구에 대한 응답을 기다기지 않고 연속해서 만들어 질 수 있다. [파이프 라이닝 pipelining]
- 일반적으로 일정기간(타임 아웃 기간) 사용되지 않으면 연결를 닫는다. 서버가 연속된 요구를 수신 할때, 서버는 객체를 연속해서 보낸다. 



## 2.2.4 사용자와 서버간의 상호작용: 쿠키

**쿠키:** http 서버는 상태를 유지하지 않는데, 서버가 사용자 접속을 제한하거나 사용자에 따라 콘텐츠를 제공하기 원하므로 웹 사이트가 사용자기 위해 쓰는 방법이다.



쿠키 기술은 네가지 요소가 있다

1) HTTP 응답 메세지 쿠키 헤더라인

2) HTTP 요청 메시지 쿠키 헤더 라인

3) 사용자의 브라우저에 사용자 종단 시스템과 관리를 지속시키는 쿠키 파일

4) 웹 사이트의 백엔드(back-end) 데이터 베이스



간단히 말하자면 웹서버가 set-cookie:  및 cookie: 헤더를 사용하여 나에 대한 기록을 쌓는 것이다. 쿠키와 사용자가 제공하는 계정 정보를 결합하여 웹사이트는 사용자에 대한 많은 것을 알 수 있고 이것을 제 3자에게 넘길 수 도 있기 때문에 큰 문제가 될 수 있다.



## 2.2.5 웹 캐싱

**웹 캐시(Web cache; 프록시 서버(proxy server)라고도 한다.)** 는 웹 서버(origin Web server)를 대신하여 HTTP 요구를 충족시키는 네트워크 개체이다. 

- 자체의 저장 디스크를 갖고 있어서 최근 호출된 객체의 사본을 저장 및 보존함
- 사용자의 모든 HTTP 요구가 웹 캐시에 가장 먼저 보내지도록 구성 될 수도 있다. 
- 캐시는 서버이면서 클라이언트 이다. 브라우저로 부터 요구를 받고 응답을 보내는 것은 서버이고, 출저 서버에게 요구를 보내거나 응답을 받는 것이 클라이언트 인데, 웹캐시는 둘의 역할을 다 하기 때문이다.

장점

- 클라이언트의 요구에 대한 응답시간을 줄일 수 있다. (특히 클라이언트와 원출처 서버사이의 병목 대역폭이 클라이언트와 캐시 사이의 병목 대역폭에 비해 매우 작을 때 더욱 효과적)
- 한 기관에서의 인터넷으로 접속하는 링크상의 웹 트래픽을 대폭 줄일 수 있다. (트래픽을 줄이면 기관이 자주 대역폭을 개선할 필요가 없게 되어 비용을 줄일 수 있음)

=> 대역폭을 늘리기 보다 기관에 웹캐시를 설치하는 것이 훨씬 효율적인 방법이다.





