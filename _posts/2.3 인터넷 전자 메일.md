## 2.3 인터넷 전자 메일

**사용자 에이전트:** 사용자 이에전트는 사용자가 메세지를 읽고, 응답하고, 전ㄴ달하고, 저장하고 구성하게 해준다.

**메일 서버:** 전자 메일 기반구조의 중심으로 각 사용자는 메일 서버안에 메일 박스(mail box)를 갖고 있다.

**SMTP(Simple Mail transfer Protocol):** 인터넷 전자 메일을 위한 주요 애플리케이션 계층 프로토콜 이다. 



## 2.3.1. SMTP

SMTP는 송신자의 메일 서버로 부터 수신자의 메일 서버로 메세지를 전송한다. 

HTTP보다 오래되어, 모든 메세지의 몸체(헤더뿐 아니라)는 단순한 7비트 ASCII이어야 하는 단점이 있다.

<엘리스가 밥에게 메세지를 전달하는 사진>

- SMTP가 메일을 보내는 데 두 서버가 먼 거리에 떨어져 있어더라도 중간 메일을 서버를 사용하지 않는다.
- 수신하는 상대방의 메일 서버가 죽어있다면, 메세지는 어느 중간 서버에 저장 되는 것이 아니라 송신하는 메일 서버에 남아 새로운 시도를 위해 기다린다.



#### 전송 하는 과정

1) 클라이언트 SMTP(송신 메일 서버 호스트에서 수행)는 서버 SMTP(수신 메일 서버 호스트에서 수행)의 25번 포트로 TCP연결을 설정. - 만약 서버가 죽어 있으면 클라이언트는 나중에 다시 시도 한다.

2) 해당 연결이 설정되면, 서버와 클라이언트틑 애플리케이션 계층 핸드셰이킹을 수행

3) 서로에 대한 소개를 마치면(전자메일 주소) 클라이언트는 TCP의 신뢰적인 데이터 전송 서비스를 의존하여 메세지를 보낸다.

4) 서버에 보낼 다른 메세지가 있으면 클라이언트킄 이 과정을 같은 TCP 연결상에서 반복한다. 그렇지 않으면 TCP에게 연결을 닫을 것을 명령한다.



## 2.3.2. HTTP와의 비교

#### 공통점

- 두 프로토콜 모두 한 호스트에서 다른 호스트로 파일을 전송하는 데 이용이 된다.
  - HTTP: 웹 서버로 부터 웹 사용자 에이전트(브라우저)로 파일(혹은 객체)을 전송한다. 
  - SMTP: 한 메일 서버로 부터 다른 메일 서버로 파일(전자메일 메세지)를 전송한다. 

- 파일을 전송할 때 둘 다 지속 연결을 사용한다. 

#### 차이점 

1) HTTP는 원칙적으로 Pull 프로토콜 이다. 누군가 서버에 정보를 올리고 사용자가 편의에 의해서 서버로 정보를 가져오기 위해   사용한다.  특히, TCP 연결은 파일을 수신 할 컴퓨터가 먼저 초기화 한다.

SMTP는 원칙적으로 push 프로토콜이다. 송신 메일 서버가 수신 메일 서버로 보낸다. TCP연결은 파일 보내는 컴퓨터에서 먼저 초기화해야 한다. 

2) SMTP는 각 메세지 몸체를 포함하여 각 메시지가 7비트 ASCII포맷 일 것을 요구한다. 반면에 HTTP 데이터는 이러한 제한이 없다.

3) 텍스트와 이미지로 구성된 문서를 다루는 방법이다. HTTP는 자신의 HTTP응답 메시지에 각 객체를 캡슐화 한다. 인터넷 메일은 모든 메세제의 객체를 한 메세지로 만든다. 



## 2.3.3 메일 메시지 포맷

전자 메일을 보낼 때 주변정보가 포함된 헤더가 메세지 몸체 앞에 오게 된다. 정보는 일년의 헤더라인에 포함되는 데 RFC 5322에 정의 되어 있다. 헤더 라인과 메세지 몸체는 빈줄 (CRLF)로 분리 된다. 



## 2.3.4 메일 접속 프로토콜

오늘날의 메일 접속을 클라이언트-서버 구조를 사용한다.

메일 서버가 메일 박스를 관리 하고 SMTP의 클라이언트와 서버 측 모두를 수행한다. 사용자의 메일 서버가 로컬PC에 있다면, 전자 메일을 수신하기 위해 언제나 켜져 있어야 한다. 이것은 인터넷 사용자에게 비현실적인 방법이다.

그렇기 때문에 일반 사용자는 로컬 PC에서 사용자 에이전트를 수행하고 늘 켜져 있는 공유 메일 서버에 저장된 메일 박스에 접근한다. 메일 서버는 보통 사용자들과 공유하고 전형적으로 사용자의 사용자의 ISP(대학, 회사)이 유지 관리한다.

엘리스의 에이전트 --(SMTP)--> 엘리스의 메일 서버 --(SMTP)--> 밥의 메일 서버 --(pop3, IMAP, HTTP)--> 밥의 에이전트

수신자 에이전트는 메세지를 얻기 위해 SMTP를 사용 할 수 없다. 이는 SMTP가 push 프로토콜인 반면에 메세지를 얻는 것은 pull인 동작이기 때문이다. 이를 위해서 POP3, IMAP, HTTP와 같은 메일 접속 프로토콜을 사용한다.  

#### POP3

 매우 간단한 메일 접속 프로토콜. 사용자 에이전트가 메일 서버의 포트 110번으로 TCP연결을 열때 시작한다. 

인증 -> 트랜잭션 -> 갱신의 방법으로 진행한다. 

#### IMAP

POP3를 이용하여 사용자가 로컬 컴퓨터로 메세지를 다운로드 하면, 메일 폴더를 생성하고 다운로드된 메세지를 이동 할 수 있는데, 이렇게 될 경우 원격 서버에서는 인식 할 수 없다. 이를 해결하기 위한 것이 IMAP( internet Mail Access protocol)이다.

- IMAP세션을 통해 사용자 상태 정보를 유지한다는 점을 명심해야 한다. 

- 사용자가 에이전트 메시지의 구성 요소를 얻을 수 있게 허용하는 명령을 가지고 있다. (ex 메세지 헤더만 얻기, 멀티파트 MIME 메세지의 일부만 얻기 등)



#### 웹 기반 전자메일

사용자 에이전트는 일반 웹 브라우저 이고 사용자는 HTTP를 통해 메일 서버에 있는 원격 메일 박스와 통신하게 된다. 

송신자가 전자메일 메세지를 보내고자 할 때, 전자 메일 메세지는 SMTP 대신에 HTTP를 이용하여 브라우저에서 메일 서버로 절달 된다. <u>그러나 메일 서버는 여전히 SMTP를 이용하여 메세지를 다른 메일 서버로 절달 하거나 다른 메일 서버로 부터 수신한다.</u> 



